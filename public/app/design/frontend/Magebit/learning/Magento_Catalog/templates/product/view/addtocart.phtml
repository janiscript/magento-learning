<?php
/**
 * Add to cart template
 */
?>
<?php
/** @var \Magento\Catalog\Block\Product\View $block */
/** @var \Magento\Framework\Escaper $escaper */
?>
<div class="box-tocart">
    <div class="fieldset">
        <?php if ($block->shouldRenderQuantity()): ?>
        <div class="field qty">
            <label class="label" for="qty"><span><?= $escaper->escapeHtml(__('Quantity:')) ?></span></label>
            <div class="quantity-stock-wrapper">
                <div id="custom-qty" class="control" data-bind="scope: 'qty-counter'">
                    <!-- ko template: getTemplate() --><!-- /ko -->
                    <script type="text/x-magento-init">
                        {
                            "#custom-qty": {
                                "Magento_Ui/js/core/app": {
                                    "components": {
                                        "qty-counter": {
                                            "component": "qty-counter",
                                            "config": {
                                                "qty": <?= $block->getProductDefaultQty() * 1 ?>,
                                                "dataValidate": <?= json_encode($block->getQuantityValidators()) ?>
                                            }
                                        }
                                     }
                                }
                            }
                        }
                    </script>
                </div>
                <?php $_product = $block->getProduct(); ?>
                <?php if ($_product->isAvailable()): ?>
                                 <div class="stock-indicator">
                     <div class="stock-icon">
                         <img src="<?= $escaper->escapeUrl($this->getViewFileUrl('Magento_Catalog::images/check-mark-black-outline-svgrepo-com.svg')) ?>" 
                              alt="<?= $escaper->escapeHtmlAttr(__('In Stock')) ?>" 
                              width="16" 
                              height="16" />
                     </div>
                     <span class="stock-text"><?= $escaper->escapeHtml(__('IN STOCK')) ?></span>
                     <?php 
                     $objectManager = \Magento\Framework\App\ObjectManager::getInstance();
                     $stockRegistry = $objectManager->get('\Magento\CatalogInventory\Api\StockRegistryInterface');
                     $stockItem = $stockRegistry->getStockItem($_product->getId());
                     $stockQty = $stockItem->getQty();
                     ?>
                     <?php if ($stockQty > 0): ?>
                     <span class="stock-qty"><?= (int)$stockQty ?> <?= $escaper->escapeHtml(__('items available')) ?></span>
                     <?php endif; ?>
                 </div>
                <?php endif; ?>
            </div>
        </div>
        <?php endif; ?>
        <div class="actions">
            <button type="submit"
                    title="<?= $escaper->escapeHtml($block->getAddToCartUrl($block->getProduct())) ?>"
                    class="action primary tocart"
                    id="product-addtocart-button">
                <span><?= $escaper->escapeHtml(__('Add to Cart')) ?></span>
            </button>
            <?= $block->getChildHtml('', true) ?>
        </div>
    </div>
</div> 